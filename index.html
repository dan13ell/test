<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf‑8">
  <meta name="viewport" content="width=device‑width,initial‑scale=1">
  <title>Popcat Live: Česko & Slovensko</title>
  <style>
    /* --- Reset + base --- */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#121212; color:#e0e0e0; font‑family:Arial, sans‑serif; display:flex; flex‑direction:column; align‑items:center; padding:20px; }
    h1 { margin‑bottom:20px; }
    .card { background:#1e1e1e; border‑radius:10px; padding:20px; width:100%; max‑width:500px; margin:10px; box‑shadow:0 4px 10px rgba(0,0,0,0.5); transition:transform 0.3s; }
    .card:hover { transform:translateY(-5px); }
    .stat { display:flex; justify‑content:space‑between; margin:10px 0; }
    .label { font‑size:1.1em; }
    .value { font‑size:1.3em; font‑weight:bold; }
    .cpsBar { height:8px; border‑radius:4px; background:#333; overflow:hidden; margin:5px 0; }
    .cpsFill { height:100%; background:#76ff03; width:0; transition:width 1s ease‑out; }
    @media (max‑width:600px) {
      .card { padding:15px; }
      .value { font‑size:1.1em; }
    }
  </style>
</head>
<body>
  <h1>Popcat Live – 🇨🇿 Česko & 🇸🇰 Slovensko</h1>
  <div id="cards"></div>

  <script>
  async function fetchLeaderboard() {
    const resp = await fetch('https://leaderboard.popcat.click/');
    const txt = await resp.text();
    const dom = new DOMParser().parseFromString(txt, 'text/html');
    const rows = Array.from(dom.querySelectorAll('tr'));
    const data = rows.map(r => {
      const tds = r.querySelectorAll('td');
      if (tds.length >= 3) {
        return {
          rank: Number(tds[0].textContent.trim().replace('.', '')) || null,
          country: tds[1].textContent.trim(),
          clicks: Number(tds[2].textContent.trim().replace(/[,.]/g,'')),
          cps: Number((tds[3]?.textContent || '').trim().replace(/[,.]/g,'')) || null
        };
      }
    }).filter(x => x && (x.country === 'Czechia' || x.country === 'Slovakia'));
    return data;
  }

  function updateUI(data) {
    const cards = document.getElementById('cards');
    cards.innerHTML = '';
    data.forEach(d => {
      const card = document.createElement('div');
      card.className = 'card';
      const countryName = d.country === 'Czechia' ? 'Česko' : 'Slovensko';
      card.innerHTML = `
        <div class="stat"><span class="label">${countryName}</span><span class="value">${d.clicks.toLocaleString()}</span></div>
        <div class="stat"><span class="label">CPS</span><span class="value">${d.cps?.toLocaleString()||'–'}</span></div>
        <div class="cpsBar"><div class="cpsFill" style="width: ${d.cps?Math.min(d.cps/50000*100,100):0}%"></div></div>
        <div class="stat"><span class="label">Na přeskočení další:</span><span class="value" id="need-${d.country}">…</span></div>
      `;
      cards.append(card);
    });

    // spočítat rozdíly
    if (data.length === 2) {
      const [cz, sk] = data[0].country==='Czechia'? data : data.reverse();
      const sorted = [...data].sort((a,b)=>b.clicks - a.clicks);
      sorted.forEach(d => {
        const next = sorted.find(n=>n.clicks> d.clicks);
        const diff = next ? next.clicks - d.clicks + 1 : 0;
        const elem = document.getElementById(`need-${d.country}`);
        elem.textContent = diff > 0 ? diff.toLocaleString() : 'v čele';
      });
    }
  }

  async function refresh() {
    try {
      const data = await fetchLeaderboard();
      updateUI(data);
    } catch (e) {
      console.error(e);
    }
  }

  // prvotní načtení + perioda každých 10 s
  refresh();
  setInterval(refresh, 10000);
  </script>
</body>
</html>
